%{
    #include "node.h" // Include the shared header for Node structure and functions
    #include "parser.tab.h"
    #include <stdlib.h>
    #include <string.h>

    extern char *yytext; // Declare yytext
    extern void yyerror(const char* s);  // Declare yyerror

%}

%%

[0-9]+ {
    // yylval.num = atoi(yytext);
    yylval.str = strdup(yytext); // return as string due to IR being string-based
    return INTEGER;
}

\n+ { /* Ignore whitespace */ }

[ \t\n]+ { /* Ignore whitespace */ }

[ \r\n]+ { /* Ignore whitespace */ }


    
"ğŸ‘…".* { /* Ignore comments*/ }

"(" { return PARENTHESIS_OPEN; }   // Return '(' token
")" { return PARENTHESIS_CLOSE; }   // Return ')' token


ğŸ‘ï¸ { return PROGRAM_BEGIN; }
ğŸ‘ï¸ { return PROGRAM_END; }
ğŸ’¯ { return INTEGER_TYPE; }
ğŸ”¤ { return STRING_TYPE; }
ğŸ”¢ { return INT_ARRAY_TYPE; }
â‰ï¸ { return BOOL_TYPE; }
âœ… { return BOOL_TRUE; }
âŒ { return BOOL_FALSE; }

ğŸ‘‰([^ğŸ‘ˆ]+)ğŸ‘ˆ {
    char *str = strdup(yytext);

    // Remove the first and last character
    str+=4;
    str[strlen(str) - 4] = '\0';

    // Emojis are UTF-8 encoded, so we need to remove the extra bytes

    yylval.str = str;
    return STRING;
}



ğŸª£ { return VARIABLE_DECLARATION; }
ğŸš¬ { return ARRAY_DECLARATION_DIVIDER; }
â• { return INTEGER_ADDITION; }
â– { return INTEGER_SUBTRACTION; }
âœ– { return INTEGER_MULTIPLICATION; }
â— { return INTEGER_DIVISION; }
â™» { return INTEGER_MODULUS; }
ğŸŸ° { return ASSIGN; }
ğŸ”¼ { return GREATER_THAN; }
ğŸ”½ { return LESS_THAN; }
â« { return GREATER_THAN_EQUAL; }
â¬ { return LESS_THAN_EQUAL; }
ğŸ” { return EQUAL; }
ğŸ”€ { return NOT_EQUAL; }
â— { return NEGATION; }
ğŸ…° { return AND; }
ğŸ…¾ { return OR; }
ğŸ¤” { return IF_START; }
ğŸ˜¬ { return IF_END; }
ğŸ˜’ { return ELSE; }
ğŸ«¸ { return CONDITION_BEGIN; }
ğŸ«· { return CONDITION_END; }
ğŸ£ { return FOR_BEGIN; }
ğŸ¥ { return FOR_END; }
ğŸš­ { return FOR_CONDITION_SEPARATOR; }
ğŸ³ { return WHILE_BEGIN; }
ğŸ‹ { return WHILE_END; }
ğŸ’… { return PRINT; }
âœ { return INPUT; }

[a-zA-Z_][a-zA-Z0-9_]* { // Needs to be declared last
    yylval.str = strdup(yytext); // Copy the identifier name
    return IDENTIFIER;          // Return the IDENTIFIER token
}

[a-zA-Z_] { // Needs to be declared last
    yylval.str = strdup(yytext); // Copy the identifier name
    return IDENTIFIER;          // Return the IDENTIFIER token
}



. {
    yyerror("Invalid character encountered");
    return 0; // This returns control back to Bison
}

%%

int yywrap() {
    return 1;
}
